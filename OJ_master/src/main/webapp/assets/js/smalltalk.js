CodeMirror.defineMode("smalltalk",function(n,t){function e(n,t,e){return t.tokenize=e,e(n,t)}function r(n,t){return f=n,t}function i(n,t){var i=n.next();return'"'==i?e(n,t,u(i)):"'"==i?e(n,t,o(i)):"#"==i?(n.eatWhile(/[\w\$_]/),r("string","string")):/\d/.test(i)?(n.eatWhile(/[\w\.]/),r("number","number")):/[\[\]()]/.test(i)?r(i,null):(n.eatWhile(/[\w\$_]/),s&&s.propertyIsEnumerable(n.current())?r("keyword","keyword"):r("word","variable"))}function o(n){return function(t,e){for(var o,u=!1,l=!1;null!=(o=t.next());){if(o==n&&!u){l=!0;break}u=!u&&"\\"==o}return(l||!u)&&(e.tokenize=i),r("string","string")}}function u(n){return function(t,e){for(var o,u=!1;null!=(o=t.next());)if(o==n){u=!0;break}return u&&(e.tokenize=i),r("comment","comment")}}function l(n,t,e,r,i){this.indented=n,this.column=t,this.type=e,this.align=r,this.prev=i}function a(n,t,e){return n.context=new l(n.indented,t,e,null,n.context)}function c(n){return n.context=n.context.prev}var f,s={"true":1,"false":1,nil:1,self:1,"super":1,thisContext:1},d=n.indentUnit;return{startState:function(n){return{tokenize:i,context:new l((n||0)-d,0,"top",!1),indented:0,startOfLine:!0}},token:function(n,t){var e=t.context;if(n.sol()&&(null==e.align&&(e.align=!1),t.indented=n.indentation(),t.startOfLine=!0),n.eatSpace())return null;var r=t.tokenize(n,t);return"comment"==f?r:(null==e.align&&(e.align=!0),"["==f?a(t,n.column(),"]"):"("==f?a(t,n.column(),")"):f==e.type&&c(t),t.startOfLine=!1,r)},indent:function(n,t){if(n.tokenize!=i)return 0;var e=t&&t.charAt(0),r=n.context,o=e==r.type;return r.align?r.column+(o?0:1):r.indented+(o?0:d)},electricChars:"]"}}),CodeMirror.defineMIME("text/x-stsrc",{name:"smalltalk"});